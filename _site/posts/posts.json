[
  {
    "path": "posts/2022-06-08-curva-de-juros-de-americana-us-treasuries-curve/",
    "title": "Curva de Juros de Americana - US Treasuries Curve",
    "description": "Como construir a curva de juros americana utilizando dados do Tesouro\nAmericano (US Treasury) e o pacote {fixedincome}.",
    "author": [
      {
        "name": "Wilson Freitas",
        "url": {}
      }
    ],
    "date": "2022-06-06",
    "categories": [
      "R",
      "fixedincome",
      "opendata"
    ],
    "contents": "\r\nA curva de juros americana √© uma pe√ßa fundamental do quebra-cabe√ßas econ√¥mico/financeiro. Neste post vamos ver como obter os dados do hist√≥rico da estrutura a termo de juros dos Estados Unidos e como construir uma curva de juros utilizando o pacote {fixedincome}.\r\nVamos utilizar o Quandl, que hoje √© o Nasdaq Data Link, para obter o hist√≥rico de juros americanos.\r\n\r\n\r\nlibrary(Quandl)\r\n\r\nyc_all <- Quandl(\"USTREASURY/YIELD\")\r\n\r\n\r\n\r\n\r\n\r\n\r\nyc_all traz todo o hist√≥rico de juros, as Constant Maturity Treasury rates, que relacionam as taxas de juros ao um conjuto de prazos padronizados: 1, 3, e 6 meses, e 1, 2, 3, 5, 7, 10, 20, e 30 anos.\r\n\r\n\r\nhead(yc_all)\r\n\r\n\r\n        Date 1 MO 2 MO 3 MO 6 MO 1 YR 2 YR 3 YR 5 YR 7 YR 10 YR 20 YR\r\n1 2022-02-04 0.05 0.12 0.23 0.56 0.89 1.31 1.55 1.78 1.90  1.93  2.29\r\n2 2022-02-03 0.03 0.15 0.20 0.48 0.78 1.19 1.42 1.66 1.78  1.82  2.20\r\n3 2022-02-02 0.04 0.10 0.19 0.45 0.76 1.16 1.38 1.60 1.74  1.78  2.17\r\n4 2022-02-01 0.04 0.10 0.19 0.48 0.78 1.18 1.39 1.63 1.76  1.81  2.19\r\n5 2022-01-31 0.03 0.13 0.22 0.49 0.78 1.18 1.39 1.62 1.75  1.79  2.17\r\n6 2022-01-28 0.04 0.10 0.19 0.43 0.75 1.15 1.38 1.61 1.74  1.78  2.14\r\n  30 YR\r\n1  2.23\r\n2  2.14\r\n3  2.11\r\n4  2.12\r\n5  2.11\r\n6  2.07\r\n\r\nVamos montar a curva de juros para uma data espec√≠fica utilizando os prazos definidos no hist√≥rico.\r\n\r\n\r\nlibrary(tidyverse)\r\n\r\nrefdate <- as.Date(\"2022-02-04\")\r\nyc <- yc_all |> filter(Date == refdate)\r\n\r\nyc\r\n\r\n\r\n        Date 1 MO 2 MO 3 MO 6 MO 1 YR 2 YR 3 YR 5 YR 7 YR 10 YR 20 YR\r\n1 2022-02-04 0.05 0.12 0.23 0.56 0.89 1.31 1.55 1.78  1.9  1.93  2.29\r\n  30 YR\r\n1  2.23\r\n\r\nComecemos construindo o vetor de prazos da curva. Para isso precisamos interpretar os nomes das colunas e convert√™-los em prazos.\r\n\r\n\r\nnx <- names(yc)\r\nterms_names <- nx[-1]\r\nterms_names\r\n\r\n\r\n [1] \"1 MO\"  \"2 MO\"  \"3 MO\"  \"6 MO\"  \"1 YR\"  \"2 YR\"  \"3 YR\"  \"5 YR\" \r\n [9] \"7 YR\"  \"10 YR\" \"20 YR\" \"30 YR\"\r\n\r\nTemos MO indicando prazos em meses e YR indicando os anos. Vamos utilizar uma simples substitui√ß√£o de texto para converter MO para months e YR para years. Dessa forma podemos utilizar a fun√ß√£o fixedincome::as.term que converte um string em um objeto term (prazo).\r\n\r\n\r\nlibrary(stringr)\r\n\r\nterms_names <- terms_names |>\r\n  str_replace(\"MO\", \"months\") |>\r\n  str_replace(\"YR\", \"years\")\r\n\r\nterms_names\r\n\r\n\r\n [1] \"1 months\" \"2 months\" \"3 months\" \"6 months\" \"1 years\"  \"2 years\" \r\n [7] \"3 years\"  \"5 years\"  \"7 years\"  \"10 years\" \"20 years\" \"30 years\"\r\n\r\nAp√≥s a convers√£o usamos a fun√ß√£o purrr::map com a fun√ß√£o fixedincome::as.term e assim vamos obter uma lista com diversos objetos term.\r\n\r\n\r\nlibrary(purrr)\r\nlibrary(fixedincome)\r\n\r\ncurve_terms <- map(terms_names, as.term)\r\ncurve_terms\r\n\r\n\r\n[[1]]\r\n[1] \"1 month\"\r\n\r\n[[2]]\r\n[1] \"2 months\"\r\n\r\n[[3]]\r\n[1] \"3 months\"\r\n\r\n[[4]]\r\n[1] \"6 months\"\r\n\r\n[[5]]\r\n[1] \"1 year\"\r\n\r\n[[6]]\r\n[1] \"2 years\"\r\n\r\n[[7]]\r\n[1] \"3 years\"\r\n\r\n[[8]]\r\n[1] \"5 years\"\r\n\r\n[[9]]\r\n[1] \"7 years\"\r\n\r\n[[10]]\r\n[1] \"10 years\"\r\n\r\n[[11]]\r\n[1] \"20 years\"\r\n\r\n[[12]]\r\n[1] \"30 years\"\r\n\r\nObviamente tudo isso poderia ter sido feito de forma direta.\r\n\r\n\r\ncurve_terms <- nx[-1] |>\r\n  str_replace(\"MO\", \"months\") |>\r\n  str_replace(\"YR\", \"years\") |>\r\n  map(as.term)\r\n\r\n\r\n\r\nPois bem, temos uma lista com prazos em meses e prazos em anos. √â necess√°rio converter os prazos para uma mesma unidade (units). Vou converter todos os prazos para dias. Para fazer isso vou criar um objeto daycount(\"actual/360\"), que √© a regra de contagem de dias que considera dias corridos e anos com 360 dias. Com a regra de contagem de dias conseguimos fazer a convers√£o dos prazos para anos e utilizando a quantidade de dias no ano da regra, 360, fazemos a convers√£o para dias.\r\n\r\n\r\ndc <- daycount(\"actual/360\")\r\n\r\nterms <- curve_terms |>\r\n    map_dbl(\\(x) dib(dc) * toyears(dc, x)) |>\r\n    term(\"days\")\r\n\r\nterms\r\n\r\n\r\n [1] \"30 days\"    \"60 days\"    \"90 days\"    \"180 days\"   \"360 days\"  \r\n [6] \"720 days\"   \"1080 days\"  \"1800 days\"  \"2520 days\"  \"3600 days\" \r\n[11] \"7200 days\"  \"10800 days\"\r\n\r\nA fun√ß√£o fixedincome::toyears converte os prazos para um n√∫mero em anos, por exemplo, 6 meses retorna 0.5, e a fun√ß√£o dib retorna a quantidade de dias no ano para a regra, neste caso, 360. Conclu√≠mos criando os objetos de prazo com term.\r\nAgora que j√° temos os prazos da curva vamos extrair as taxas do data.frame. √â uma opera√ß√£o simples de extra√ß√£o de linhas de um data.frame e converter em um vetor. Fazemos uma verifica√ß√£o de NA por que eventualmente h√° podemos ter valores ausentes para alguns prazos.\r\n\r\n\r\nrates <- yc[1, -1] |>\r\n    as.list() |>\r\n    as.numeric()\r\nrates <- rates / 100\r\nix <- !is.na(rates)\r\n\r\nrates[ix]\r\n\r\n\r\n [1] 0.0005 0.0012 0.0023 0.0056 0.0089 0.0131 0.0155 0.0178 0.0190\r\n[10] 0.0193 0.0229 0.0223\r\n\r\nTendo os prazos, as taxas e a data de refer√™ncia, podemos construir a curva com a fun√ß√£o fixedincome::spotratecurve. Para a curva de juros americana utilizamos taxa de juros simples (compounding simple), regra de contagem de dias (actual/360) e o calend√°rio de dias corridos (actual).\r\n\r\n\r\ntr_curve <- spotratecurve(\r\n    rates[ix], terms[ix],\r\n    \"simple\", \"actual/360\", \"actual\",\r\n    refdate = refdate\r\n)\r\n\r\ntr_curve\r\n\r\n\r\n          SpotRateCurve\r\n30 days          0.0005\r\n60 days          0.0012\r\n90 days          0.0023\r\n180 days         0.0056\r\n360 days         0.0089\r\n720 days         0.0131\r\n1080 days        0.0155\r\n1800 days        0.0178\r\n2520 days        0.0190\r\n3600 days        0.0193\r\n# ... with 2 more rows\r\nsimple actual/360 actual \r\nReference date: 2022-02-04 \r\n\r\nNote os prazos em dias. Agora √© s√≥ visualizar a curva de forma graciosa!\r\n\r\n\r\nplot(tr_curve)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "preview": "posts/2022-06-08-curva-de-juros-de-americana-us-treasuries-curve/curva-de-juros-de-americana-us-treasuries-curve_files/figure-html5/unnamed-chunk-10-1.png",
    "last_modified": "2022-06-08T06:41:20-03:00",
    "input_file": {},
    "preview_width": 1248,
    "preview_height": 768
  },
  {
    "path": "posts/2022-06-05-indicadores-da-pesquisa-focus/",
    "title": "Indicadores da Pesquisa Focus",
    "description": "As APIs de Expectativas de Mercado da Pesquisa Focus n√£o informam\ndireito quais indicadores est√£o dispon√≠veis. A documenta√ß√£o √© meio falha e\npouco confi√°vel. Dessa maneira, a √∫nica maneira de descobrir o que est√°\ndispon√≠vel √© investigando a API. √â isso que vou mostrar como fazer neste post.",
    "author": [
      {
        "name": "Wilson Freitas",
        "url": {}
      }
    ],
    "date": "2022-06-05",
    "categories": [
      "R",
      "bcb",
      "opendata"
    ],
    "contents": "\r\n\r\nContents\r\nFun√ß√£o get_market_expectations\r\nDescobrindo indicadores dispon√≠veis\r\nannual\r\nmonthly\r\nquarterly\r\ninflation-12-months\r\ntop5s-annual\r\ntop5s-monthly\r\ntop5s-selic\r\nselic\r\ninstitutions\r\n\r\nConclus√£o\r\n\r\n√â poss√≠vel obter as expectativas de mercado para diversos indicadores macroecon√¥micos da pesquisa Focus de forma totalmente autom√°tica utilizando o R.\r\nVamos utilizar o pacote {rbcb} para obter estes dados. O pacote {rbcb} √© uma interface para algumas das diversas APIs do portal de dados abertos do Banco Central (link).\r\nAs expectativas de mercado para os indicadores macroecon√¥micos da pesquisa Focus s√£o consolidadas em estat√≠sticas di√°rias e divulgadas na API. Estas estat√≠sticas s√£o calculadas com base nas expectativas de mercado de diversos bancos, gestores de recursos e demais institui√ß√µes do mercado financeiro. Os indicadores macroecon√¥micos s√£o referentes a √≠ndices de pre√ßos, crescimento do PIB e da produ√ß√£o industrial, taxa de c√¢mbio, taxa Selic, vari√°veis fiscais e indicadores do setor externo e s√£o publicadas todo primeiro dia √∫til da semana.\r\nCarregando os pacotes utilizados.\r\n\r\n\r\nlibrary(dplyr)\r\nlibrary(ggplot2)\r\nlibrary(rbcb)\r\n\r\n\r\n\r\nFun√ß√£o get_market_expectations\r\nA fun√ß√£o get_market_expectations implementa a interface para a API de expectativas de mercado da pesquisa Focus. Vejamos os seus argumentos e o que podemos fazer com eles:\r\n\r\n\r\nget_market_expectations |> args()\r\n\r\n\r\nfunction (type = c(\"annual\", \"quarterly\", \"monthly\", \"inflation-12-months\", \r\n    \"top5s-monthly\", \"top5s-annual\", \"institutions\", \"selic\", \r\n    \"top5s-selic\"), indic = NULL, start_date = NULL, end_date = NULL, \r\n    keep_names = TRUE, ...) \r\nNULL\r\n\r\ntype: A API de expectativas possui diversos endpoints e o argumento type define qual deve ser utilizado. Se n√£o for informado o valor annual ser√° utilizado.\r\nannual, quarterly e monthly retorna, respectivamente, as expectativas anuais, trimestrais e mensais dos indicadores macroecon√¥micos\r\ninflation-12-months para expectativas de infla√ß√£o nos pr√≥ximos 12 meses\r\ntop5s-monthly e top5s-annual retorna as expectativas mensais e anuais para os indicadores do Top 5\r\ninstitutions expectativas informadas pelas institui√ß√µes credenciadas\r\nselic expectativas de mercado SELIC\r\ntop5s-selic expectativas Top 5 para SELIC\r\n\r\nindic nome do indicador macroecon√¥mico, √© opcional, de forma, quando n√£o for definido, todos os indicadores dispon√≠veis para o endpoint ser√£o retornados. Esse ponto √© curioso, pois a documenta√ß√£o n√£o √© boa e informa indicadores que n√£o s√£o mais disponibilizados.\r\nstart_date e end_date definem as datas de in√≠cio e fim para a consulta, s√£o opcionais e caso n√£o sejam informados, todo o per√≠odo ser√° retornado, o que n√£o √© recomendado pois onera os servi√ßos de dados do BCB que j√° n√£o s√£o l√° os melhores.\r\nkeep_names √© um argumento utilizado internamente que n√£o faz diferen√ßa para o usu√°rio final.\r\n... aqui s√£o passados argumentos adicionais para a API\r\n$select define as colunas retornadas na consulta: Nome, Idade\r\n$filter define filtros mais elaborados baseado nos valores das colunas: Nome eq 'Jo√£o'\r\n$orderby define como as colunas devem ser ordenadas: Nome asc, Idade desc\r\n$skip define quantidade de linhas no come√ßo que n√£o devem ser retornadas\r\n$top define a quantidade de linhas que ser√£o retornadas\r\n\r\nDescobrindo indicadores dispon√≠veis\r\nPara descobrir os indicadores macroecon√¥micos dispon√≠veis para um determinado endpoint √© necess√°rio realizar duas consultas. A primeira para descobrir a data mais recente com dados, pois a disponibilidade dos indicadores varia com o tempo, de maneira que temos indicadores mais recentes que n√£o est√£o no hist√≥rico antigo. Tendo esta data, realizamos a segunda consulta filtrando por esta data.\r\nVamos fazer isso para cada um dos endpoints.\r\nannual\r\nConsulta 1\r\n\r\n\r\nget_market_expectations(\"annual\",\r\n                        `$top` = 1,\r\n                        `$select` = \"Data\",\r\n                        `$orderby` = \"Data desc\") |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\nConsulta 2\r\n\r\n\r\nget_market_expectations(\"annual\",\r\n                        `$select` = \"Data,Indicador,IndicadorDetalhe\",\r\n                        `$filter` = \"Data eq '2022-04-29'\") |>\r\n  distinct(Indicador, IndicadorDetalhe) |>\r\n  arrange(Indicador, IndicadorDetalhe) |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\nEste endpoint tem uma coluna IndicadorDetalhe, que √© como uma especifica√ß√£o do indicador. No caso, Balan√ßa Comercial-Saldo ou Balan√ßa Comercial-Exporta√ß√µes, por exemplo.\r\nmonthly\r\nConsulta 1\r\n\r\n\r\nget_market_expectations(\"monthly\",\r\n                        `$top` = 1,\r\n                        `$select` = \"Data\",\r\n                        `$orderby` = \"Data desc\") |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\nConsulta 2\r\n\r\n\r\nget_market_expectations(\"monthly\",\r\n                        `$select` = \"Data,Indicador\",\r\n                        `$filter` = \"Data eq '2022-04-29'\") |>\r\n  distinct(Indicador) |>\r\n  arrange(Indicador) |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\nquarterly\r\nConsulta 1\r\n\r\n\r\nget_market_expectations(\"quarterly\",\r\n                        `$top` = 1,\r\n                        `$select` = \"Data\",\r\n                        `$orderby` = \"Data desc\") |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\nConsulta 2\r\n\r\n\r\nget_market_expectations(\"quarterly\",\r\n                        `$select` = \"Data,Indicador\",\r\n                        `$filter` = \"Data eq '2022-04-29'\") |>\r\n  distinct(Indicador) |>\r\n  arrange(Indicador) |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\ninflation-12-months\r\nConsulta 1\r\n\r\n\r\nget_market_expectations(\"inflation-12-months\",\r\n                        `$top` = 1,\r\n                        `$select` = \"Data\",\r\n                        `$orderby` = \"Data desc\") |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\nConsulta 2\r\n\r\n\r\nget_market_expectations(\"inflation-12-months\",\r\n                        `$select` = \"Data,Indicador\",\r\n                        `$filter` = \"Data eq '2022-04-29'\") |>\r\n  distinct(Indicador) |>\r\n  arrange(Indicador) |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\ntop5s-annual\r\nConsulta 1\r\n\r\n\r\nget_market_expectations(\"top5s-annual\",\r\n                        `$top` = 1,\r\n                        `$select` = \"Data\",\r\n                        `$orderby` = \"Data desc\") |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\nConsulta 2\r\n\r\n\r\nget_market_expectations(\"top5s-annual\",\r\n                        `$select` = \"Data,Indicador\",\r\n                        `$filter` = \"Data eq '2022-04-29'\") |>\r\n  distinct(Indicador) |>\r\n  arrange(Indicador) |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\ntop5s-monthly\r\nConsulta 1\r\n\r\n\r\nget_market_expectations(\"top5s-monthly\",\r\n                        `$top` = 1,\r\n                        `$select` = \"Data\",\r\n                        `$orderby` = \"Data desc\") |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\nConsulta 2\r\n\r\n\r\nget_market_expectations(\"top5s-monthly\",\r\n                        `$select` = \"Data,Indicador\",\r\n                        `$filter` = \"Data eq '2022-04-29'\") |>\r\n  distinct(Indicador) |>\r\n  arrange(Indicador) |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\ntop5s-selic\r\nConsulta 1\r\n\r\n\r\nget_market_expectations(\"top5s-selic\",\r\n                        `$top` = 1,\r\n                        `$select` = \"Data\",\r\n                        `$orderby` = \"Data desc\") |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\nConsulta 2\r\n\r\n\r\nget_market_expectations(\"top5s-selic\",\r\n                        `$select` = \"Data,indicador\",\r\n                        `$filter` = \"Data eq '2022-04-29'\") |>\r\n  distinct(indicador) |>\r\n  arrange(indicador) |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\nAqui temos uma pegadinha, a coluna indicador vem com sua inicial min√∫scula, diferente dos demais endpoints.\r\nselic\r\nConsulta 1\r\n\r\n\r\nget_market_expectations(\"selic\",\r\n                        `$top` = 1,\r\n                        `$select` = \"Data\",\r\n                        `$orderby` = \"Data desc\") |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\nConsulta 2\r\n\r\n\r\nget_market_expectations(\"selic\",\r\n                        `$select` = \"Data,Indicador\",\r\n                        `$filter` = \"Data eq '2022-04-29'\") |>\r\n  distinct(Indicador) |>\r\n  arrange(Indicador) |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\ninstitutions\r\nConsulta 1\r\n\r\n\r\nget_market_expectations(\"institutions\",\r\n                        `$top` = 1,\r\n                        `$select` = \"Data\",\r\n                        `$orderby` = \"Data desc\") |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\nConsulta 2\r\n\r\n\r\nget_market_expectations(\"institutions\",\r\n                        `$select` = \"Data,Indicador,IndicadorDetalhe\",\r\n                        `$filter` = \"Data eq '2021-05-31'\") |>\r\n  distinct(Indicador, IndicadorDetalhe) |>\r\n  arrange(Indicador, IndicadorDetalhe) |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\nConclus√£o\r\nObservamos que para a maior parte dos endpoints, todos exceto institutions, a √∫ltima data dispon√≠vel √© a mesma, indicando que as estat√≠sticas s√£o atualizadas conjuntamente.\r\nO endpoint institutions est√° com √∫ltima data em aproximadamente 1 ano atr√°s, o que me faz conjecturar que estes dados podem ser divulgados com 1 ano de atraso.\r\nUma vez que conhecemos os indicadores dispon√≠veis podemos utilizar o argumento indic para selecionar o indicador desejado na consulta.\r\n\r\n\r\nget_market_expectations(\"monthly\",\r\n                        indic = c(\"IPCA\", \"IGP-M\"),\r\n                        start_date = \"2022-04-29\",\r\n                        `$select` = \"Data,Indicador,DataReferencia,Media,baseCalculo\") |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "preview": {},
    "last_modified": "2022-06-05T08:09:03-03:00",
    "input_file": {}
  },
  {
    "path": "posts/2022-06-03-expectativas-focus-com-rbcb/",
    "title": "Expectativas de Mercado da Pesquisa Focus no R",
    "description": "Obtendo as expectativas de mercado para os indicadores macroecon√¥micos da\nPesquisa Focus utilizando o R e o pacote {rbcb}.",
    "author": [
      {
        "name": "Wilson Freitas",
        "url": {}
      }
    ],
    "date": "2022-06-03",
    "categories": [
      "R",
      "bcb",
      "opendata"
    ],
    "contents": "\r\n\r\nContents\r\nFun√ß√£o get_market_expectations\r\nConhecendo os valores retornados\r\nRealizando uma consulta mais elaborada\r\nVisualizando os dados\r\nS√©rie temporal das expectativas de IPCA\r\nS√©rie temporal com intervalo informado\r\n\r\n\r\n√â poss√≠vel obter as expectativas de mercado para diversos indicadores macroecon√¥micos da pesquisa Focus de forma totalmente autom√°tica utilizando o R.\r\nVamos utilizar o pacote {rbcb} para obter estes dados. O pacote {rbcb} √© uma interface para algumas das diversas APIs do portal de dados abertos do Banco Central (link).\r\nAs expectativas de mercado para os indicadores macroecon√¥micos da pesquisa Focus s√£o consolidadas em estat√≠sticas di√°rias e divulgadas na API. Estas estat√≠sticas s√£o calculadas com base nas expectativas de mercado de diversos bancos, gestores de recursos e demais institui√ß√µes do mercado financeiro. Os indicadores macroecon√¥micos s√£o referentes a √≠ndices de pre√ßos, crescimento do PIB e da produ√ß√£o industrial, taxa de c√¢mbio, taxa Selic, vari√°veis fiscais e indicadores do setor externo e s√£o publicadas todo primeiro dia √∫til da semana.\r\nCarregando os pacotes utilizados.\r\n\r\n\r\nlibrary(dplyr)\r\nlibrary(ggplot2)\r\nlibrary(rbcb)\r\n\r\n\r\n\r\nFun√ß√£o get_market_expectations\r\nA fun√ß√£o get_market_expectations implementa a interface para a API de expectativas de mercado da pesquisa Focus. Vejamos os seus argumentos e o que podemos fazer com eles:\r\n\r\n\r\nget_market_expectations |> args()\r\n\r\n\r\nfunction (type = c(\"annual\", \"quarterly\", \"monthly\", \"inflation-12-months\", \r\n    \"top5s-monthly\", \"top5s-annual\", \"institutions\", \"selic\", \r\n    \"top5s-selic\"), indic = NULL, start_date = NULL, end_date = NULL, \r\n    keep_names = TRUE, ...) \r\nNULL\r\n\r\ntype: A API de expectativas possui diversos endpoints e o argumento type define qual deve ser utilizado. Se n√£o for informado o valor annual ser√° utilizado.\r\nannual, quarterly e monthly retorna, respectivamente, as expectativas anuais, trimestrais e mensais dos indicadores macroecon√¥micos\r\ninflation-12-months para expectativas de infla√ß√£o nos pr√≥ximos 12 meses\r\ntop5s-monthly e top5s-annual retorna as expectativas mensais e anuais para os indicadores do Top 5\r\ninstitutions expectativas informadas pelas institui√ß√µes credenciadas\r\nselic expectativas de mercado SELIC\r\ntop5s-selic expectativas Top 5 para SELIC\r\n\r\nindic nome do indicador macroecon√¥mico, √© opcional, de forma, quando n√£o for definido, todos os indicadores dispon√≠veis para o endpoint ser√£o retornados. Esse ponto √© curioso, pois a documenta√ß√£o n√£o √© boa e informa indicadores que n√£o s√£o mais disponibilizados.\r\nstart_date e end_date definem as datas de in√≠cio e fim para a consulta, s√£o opcionais e caso n√£o sejam informados, todo o per√≠odo ser√° retornado, o que n√£o √© recomendado pois onera os servi√ßos de dados do BCB que j√° n√£o s√£o l√° os melhores.\r\nkeep_names √© um argumento utilizado internamente que n√£o faz diferen√ßa para o usu√°rio final.\r\n... aqui s√£o passados argumentos adicionais para a API\r\n$select define as colunas retornadas na consulta: Nome, Idade\r\n$filter define filtros mais elaborados baseado nos valores das colunas: Nome eq 'Jo√£o'\r\n$orderby define como as colunas devem ser ordenadas: Nome asc, Idade desc\r\n$skip define quantidade de linhas no come√ßo que n√£o devem ser retornadas\r\n$top define a quantidade de linhas que ser√£o retornadas\r\n\r\nConhecendo os valores retornados\r\nCada endpoint possui o seu conjuto de colunas retornadas e isso pode mudar com o tempo, dessa maneira, para conhecer cada API, eu recomendo fortemente que a op√ß√£o $top = 10 seja utilizada para limitar uma consulta inicial para conhecimento dos valores retornados.\r\n\r\n\r\nget_market_expectations(\"annual\",\r\n                        indic = \"IPCA\",\r\n                        `$top` = 10) |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\nComo vemos, tem muito NA. Talvez seja por que estamos visualizando dados muito antigos, vamos reordenar para trazer os dados mais recentes. Para isso √© necess√°rio definir a op√ß√£o $orderby.\r\n\r\n\r\nget_market_expectations(\"annual\",\r\n                        indic = \"IPCA\",\r\n                        `$top` = 10,\r\n                        `$orderby` = \"Data desc\") |>\r\n  rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\nJ√° ficou melhor, j√° √© poss√≠vel entender as informa√ß√µes retornadas.\r\nRealizando uma consulta mais elaborada\r\nPodemos definir melhor a consulta e o que queremos dela:\r\nretornar as colunas: Data, DataReferencia, Media, Mediana, Maximo, Minimo e DesvioPadrao. Para isso vamos utilizar a op√ß√£o $select.\r\nfiltrar baseCalculo igual a 0 e DataReferencia igual a 2021 ou 2022 com a op√ß√£o $filter.\r\nCom data inicial igual a 2020-12-01, para pegar os dados desde dezembro de 2020\r\n\r\n\r\ndf <- get_market_expectations(\"annual\",\r\n                              indic = \"IPCA\",\r\n                              start_date = \"2020-12-01\",\r\n                              `$filter` = \"(DataReferencia eq '2021' or DataReferencia eq '2022') and baseCalculo eq 0\",\r\n                              `$select` = \"Data,DataReferencia,Media,Mediana,DesvioPadrao,Maximo,Minimo\")\r\ndf |> head() |> rmarkdown::paged_table()\r\n\r\n\r\n\r\n\r\n\r\nVisualizando os dados\r\nCom as estat√≠sticas de expectativas de IPCA carregadas podemos come√ßar a visualiza√ß√£o dos dados. Estas expectativas s√£o referentes a infla√ß√£o cheia para os anos de 2021 e 2022 (DataReferencia). O filtro baseCalculo igual a 1 refere-se ao prazo de validade das expectativas informadas. Esta coluna pode ser 0 ou 1. baseCalculo igual a 0 considera as expectativas informadas nos √∫ltimos 30 dias no c√°lculo das estat√≠sticas e baseCalculo igual a 1 considera os √∫ltimos 4 dias. Foi escolhida baseCalculo igual a 0 por ter uma amostra maior, consequ√™ncia do per√≠odo maior.\r\nS√©rie temporal das expectativas de IPCA\r\nVamos come√ßar observando a s√©rie temporal das expectativas para cada DataReferencia.\r\n\r\n\r\ndf |>\r\n  ggplot(aes(x = Data, y = Mediana, group = DataReferencia, colour = DataReferencia)) +\r\n  geom_line() +\r\n  labs(\r\n    title = \"Expectativas para IPCA em 2021 e 2022\",\r\n    subtitle = \"M√©dia das expectativas de IPCA\",\r\n    caption = \"Dados da Pesquisa Focus obtidos com pacote rbcb\",\r\n    x = \"Data\", y = \"Infla√ß√£o\"\r\n  )\r\n\r\n\r\n\r\n\r\nCurioso ver como as expectativas de infla√ß√£o para 2021 mudaram ao longo de 2021, ou seja, erra-se miseravelmente. As expectativas para 2022 mudam menos, bem, isso at√© virar o ano.\r\nS√©rie temporal com intervalo informado\r\nVamos olhar agora apenas a DataReferencia 2021 e colocar as linhas de m√°ximo e m√≠nimo para termos uma ideia de intervalo para as expectativas.\r\n\r\n\r\ndf |>\r\n  filter(DataReferencia == 2021) |>\r\n  ggplot(aes(x = Data)) +\r\n  geom_line(aes(y = Mediana), colour = \"black\") +\r\n  geom_line(aes(y = Maximo), colour = \"grey\") +\r\n  geom_line(aes(y = Minimo), colour = \"grey\") +\r\n  geom_ribbon(aes(ymin = Minimo, ymax = Maximo), fill = \"blue\", alpha = 0.3) +\r\n  labs(\r\n    title = \"Expectativas para IPCA em 2021\",\r\n    subtitle = \"M√©dia das expectativas de IPCA com intervalo definido por m√°ximo e m√≠nimo da amostra\",\r\n    caption = \"Dados da Pesquisa Focus obtidos com pacote rbcb\",\r\n    x = \"Data\", y = \"Infla√ß√£o\"\r\n  )\r\n\r\n\r\n\r\n\r\nInteressante ver como as pesquisas erram e como, mesmo os mais ousados, n√£o saem muito do consenso. Entendo que esse √© um mecanismo necess√°rio para se colocar o ‚Äúbode na sala‚Äù, entretanto, erra-se miseravelmente, s√£o muitos vieses envolvidos.\r\n\r\n\r\n\r\n",
    "preview": "posts/2022-06-03-expectativas-focus-com-rbcb/expectativas-focus-com-rbcb_files/figure-html5/ipca-mediana-desviopadrao-1.png",
    "last_modified": "2022-06-05T06:59:27-03:00",
    "input_file": {},
    "preview_width": 1248,
    "preview_height": 768
  },
  {
    "path": "posts/2022-01-17-dados-bcb-com-python/",
    "title": "Obtendo Dados do BCB com Python",
    "description": "Obter os dados para an√°lise de forma simples √© fundamental e necess√°rio.",
    "author": [
      {
        "name": "Wilson Freitas",
        "url": {}
      }
    ],
    "date": "2022-01-17",
    "categories": [
      "Python",
      "bcb",
      "opendata"
    ],
    "contents": "\r\nObter os dados para an√°lise de forma simples √© fundamental e necess√°rio.\r\nDepois de passar alguns anos mantendo o pacote {rbcb} que faz a integra√ß√£o do R com as APIs de dados abertos do Banco Central, decidi fazer o port para Python.\r\nEm parte porque o PyPI (Python Package Index - reposit√≥rio de pacotes do Python) √© bem menos burocr√°tico que o CRAN (reposit√≥rio de pacote do R), mas nos √∫ltimos anos tenho mexido mais com Python e fazia sentido portar algumas ferramentas.\r\nO pacote {python-bcb} √© a contraparte em Python do pacote {rbcb} do R.\r\nS√≥ que acabou ficando maior, n√£o por causa do Python, mas por que eu estava com tempo e paci√™ncia e acabei implementando parte da especifica√ß√£o OData. Isso permite de forma bem simples integrar diversas APIs do Banco Central que implementam essa especifica√ß√£o. Na minha √∫ltima contagem tinha 39 APIs nessa estrutura.\r\nO pacote {python-bcb} traz as seguintes APIs:\r\nSGS\r\nS√©ries de Moedas do Conversor de Moedas do Banco Central\r\nExpectativas do FOCUS\r\nBoletins da PTAX (abertura, 3 intradi√°rios, fechamento)\r\nDados selecionados de institui√ß√µes financeiras (IFDATA)\r\nAgora o que d√° mais trabalho ao fazer a integra√ß√£o de uma API √© escrever a documenta√ß√£oüòâ dado que as APIs n√£o s√£o padronizadas.\r\nVou comunicando aqui na medida que novas APIs forem sendo integradas.\r\nObviamente espero todo o tipo de coment√°rios e sugest√µes.\r\nDocumenta√ß√£o do projeto: https://wilsonfreitas.github.io/python-bcb/index.html\r\nLink do projeto: https://github.com/wilsonfreitas/python-bcb\r\nNa imagem segue um exemplo que como utilizar a API de Expectativas do FOCUS para obter um DataFrame das expectativas de IPCA de 2021 ao longo de 2021.\r\n\r\n\r\n\r\n\r\n",
    "preview": "posts/2022-01-17-dados-bcb-com-python/expectativas.png",
    "last_modified": "2022-06-03T06:11:37-03:00",
    "input_file": {},
    "preview_width": 1328,
    "preview_height": 856
  }
]
